description: ft
target:
  service: amlk8s
  name: itp-p40-eus     
  vc: quantus
  #service: sing
  #name: msrresrchvc    
  #vc: ggcr-singularity-resrch  

environment:
  image: nvidia/20.09:v7.0.2
  registry: shumingdocker.azurecr.io
  setup:
  - pip install --user -e fairseq/
  - pip install --user -e infinibatch/
  - python -m nltk.downloader punkt
  - sudo apt-get install git-lfs
  - echo "master_addr:" "$$MASTER_ADDR"
  - echo "master_port:" $$MASTER_PORT
  - echo "node_rank:" $$OMPI_COMM_WORLD_RANK
  username: shumingdocker

code:
  local_dir: $CONFIG_DIR/../..

storage:
  msranlp:
    storage_account_name: msranlp
    container_name: unilm
  output:
    storage_account_name: yangjianunilm
    container_name: unilm

search:
  job_template:
    name: download_mc4_{lg}
    sku: C1
    command:
      - python ./scripts/mc4/preprocess_mc4.py --lg {lg}
    submit_args:
      env:
        NCCL_DEBUG: INFO
        MKL_NUM_THREADS: 1
        OMP_NUM_THREADS: 1
  type: grid
  max_trials: 500
  params:
    - name: lg
      spec: discrete
      values: ["en","ru","und","es","de","fr","ja","it","pt","pl","vi","tr","nl","id","ar","cs","fa","uk","ro","el","zh","sv","hu","da","hi","fi","bg","no","ko","mr","sk","iw","th","ms","ca","lt","sl","bn","et","lv","sr","cy","az","ta","kk","sq","ne","mt","mn","ka","hy","ur","ml","be","gl","is","mk","fil","tg","af","te","kn","eu","ky","my","sd","la","so","si","sw","km","uz","lb","gu","eo","pa","ps","ga","fy","ku","gd","am","yi","jv","ha","zu","hmn","co","mg","ceb","ht","sn","lo","su","ny","mi","ig","sm","st","haw","xh","yo"]
