description: ft
target:
  service: amlk8s
  #name: a100-8x-wus2     
  #vc: quantus
  #name: v100-8x-eus-1
  #vc: quantus
  #name: v100-8x-eus-1    
  #vc: quantus
  #name: itplabrr1cl1     
  #vc: resrchvc
  #name: v100-8x-scus     
  #vc: quantus
  name: itpwus2v100cl   
  vc: gcrprojvc1  

environment:
  image: nvidia/20.09:v7.0.2
  registry: shumingdocker.azurecr.io
  setup:
  - pip install --user -e fairseq/
  - pip install --user -e infinibatch/
  - pip install --user xlwt
  - pip install --user xlrd
  #- git clone --single-branch --branch adding_spm_tokenized_bleu https://github.com/ngoyal2707/sacrebleu.git && cd sacrebleu && python setup.py install --user
  #- git clone https://github.com/pltrdy/files2rouge.git && cd files2rouge && echo '/tmp/code/.files2rouge/' | python setup_rouge.py && python setup.py install --user
  #- python -m nltk.downloader all > nltk.log
  #- python -m nltk.downloader punkt
  username: shumingdocker

code:
  local_dir: $CONFIG_DIR/../../..

storage:
  msranlp:
    storage_account_name: msranlp
    container_name: unilm
  output:
    storage_account_name: yangjianunilm
    container_name: unilm

search:
  job_template:
    name: calculate-flores
    sku: G0
    #sku_count: 1
    command:
    - python ./scripts/flores/calculate_flores_results.py -log {log_dir} -result {log_dir}
    submit_args:
      env:
        NCCL_DEBUG: INFO
        MKL_NUM_THREADS: 1
        OMP_NUM_THREADS: 1
  type: grid
  max_trials: 500
  params:
    - name: log_dir
      spec: discrete
      values: ["/mnt/output/flores/BLEU/v6/avg61_80.pt/"]
